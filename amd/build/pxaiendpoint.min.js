define("assignsubmission_pxaiwriter/pxaiendpoint",["exports","jquery","core/ajax","./app/ai/event","./app/ai/page_change_event"],(function(_exports,_jquery,_ajax,_event,_page_change_event){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_event=_interopRequireDefault(_event),_page_change_event=_interopRequireDefault(_page_change_event);_exports.init=(id,cmid,contextid,steps_data,assignmentid,attempt_text)=>{let EventCreator=function(stepsData,assignmentId,attemptText){this.currStep=0,this.selStart=0,this.selEnd=0,this.assignmentid=assignmentId,this.attempt_text=attemptText,this.init()};return EventCreator.prototype.init=function(){this.setAttemtCountText(this.attempt_text);const container=(0,_jquery.default)(".actions-container"),blurStepButton=button=>{button instanceof HTMLElement&&(button.classList.remove("btn-outline-primary"),button.classList.add("btn-outline-secondary"))};let getSelectedTextareaText=function(name){let selText="",textArea=document.getElementsByName(name);if(textArea=textArea&&textArea.length>0?textArea[0]:null,textArea){let start=textArea.selectionStart;this.selStart=start;let finish=textArea.selectionEnd;this.selEnd=finish,selText=textArea.value.substring(start,finish)}else window.console.log("pxaiwriter : no known text selecable source");return selText}.bind(this);document.querySelector(".assignsubmission_pxaiwriter").addEventListener(_event.default.EventList.pageChange,(e=>{const event=new _page_change_event.default(e),currentStepSelector='.step-page-button[data-step-number="'.concat(event.currentStep,'"]'),currentStepButton=document.querySelector(currentStepSelector);if(!currentStepButton)return;const allStepButtons=document.querySelectorAll(".step-page-button[data-step-number]");for(const button of allStepButtons)blurStepButton(button);var button;(button=currentStepButton)instanceof HTMLElement&&(button.classList.add("btn-outline-primary"),button.classList.remove("btn-outline-secondary"))})),container.on("click","#pxaiwriter-expand-selection",function(e){const currentStep=(0,_jquery.default)(e.target).data("step");this.currStep=currentStep;const selectedText=getSelectedTextareaText("pxaiwriter-data-step-"+currentStep);selectedText?((0,_jquery.default)(":button").prop("disabled",!0),(0,_jquery.default)("#loader").removeClass("d-none"),_ajax.default.call([{methodname:"assignsubmission_pxaiwriter_expand_ai_text",args:{assignment_id:this.assignmentid,step:this.currStep,text:selectedText},done:this.handleExpandResponse.bind(this),fail:this.handleExpandFailure.bind(this)}])):(0,_jquery.default)("#text-selection-required-warning-modal").modal("show")}.bind(this)),container.on("click","#pxaiwriter-do-ai-magic",function(e){var _this$assignmentid;const currentStep=(0,_jquery.default)(e.target).data("step");this.currStep=currentStep;const titleText=(0,_jquery.default)('[name="pxaiwriter-data-step-'+currentStep+'"]').val();titleText?((0,_jquery.default)(":button").prop("disabled",!0),(0,_jquery.default)("#loader").removeClass("d-none"),_ajax.default.call([{methodname:"assignsubmission_pxaiwriter_generate_ai_text",args:{assignment_id:null!==(_this$assignmentid=this.assignmentid)&&void 0!==_this$assignmentid?_this$assignmentid:2,step:this.currStep,text:titleText},done:this.handleAiMagicResponse.bind(this),fail:this.handleAiMagicFailure.bind(this)}])):(0,_jquery.default)("#title-required-warning-modal").modal("show")}.bind(this))},EventCreator.prototype.handleAiMagicResponse=function(response){if((0,_jquery.default)(":button").prop("disabled",!1),response.hasOwnProperty("data")){this.setAttemtCountText(response.attempt_text);const textArea=(0,_jquery.default)('textarea[name="pxaiwriter-data-step-'+this.currStep+'"]');textArea.val(response.data),textArea.trigger("change")}(0,_jquery.default)("#loader").addClass("d-none")},EventCreator.prototype.handleAiMagicFailure=function(response){(0,_jquery.default)(":button").prop("disabled",!1),window.console.error(response),(0,_jquery.default)("#loader").addClass("d-none")},EventCreator.prototype.handleExpandResponse=function(response){if((0,_jquery.default)(":button").prop("disabled",!1),response.hasOwnProperty("data")){this.setAttemtCountText(response.attempt_text);const textArea=(0,_jquery.default)('textarea[name="pxaiwriter-data-step-'+this.currStep+'"]');textArea.val(response.data),textArea.trigger("change")}(0,_jquery.default)("#loader").addClass("d-none")},EventCreator.prototype.handleExpandFailure=function(error){var _responseObj$message;(0,_jquery.default)(":button").prop("disabled",!1);let responseObj=JSON.parse(error);alert(null!==(_responseObj$message=responseObj.message)&&void 0!==_responseObj$message?_responseObj$message:""),(0,_jquery.default)("#loader").addClass("d-none")},EventCreator.prototype.setAttemtCountText=function(text){text&&(0,_jquery.default)(".remaining-ai-attempts").text(text)},new EventCreator(steps_data,assignmentid,attempt_text)}}));

//# sourceMappingURL=pxaiendpoint.min.js.map