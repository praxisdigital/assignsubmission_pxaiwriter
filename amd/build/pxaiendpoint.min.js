define("assignsubmission_pxaiwriter/pxaiendpoint",["exports","jquery","core/ajax","core/notification"],(function(_exports,_jquery,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.init=assignmentId=>{let EventCreator=function(assignmentId){this.currentStep=1,this.selectedStart=0,this.selectedEnd=0,this.assignmentId=assignmentId,this.init()};const component="assignsubmission_pxaiwriter",eventList_pageChange="page-change",eventList_stepTextSave="step-save",selectors_wrapper=".assignsubmission_pxaiwriter",selectors_doAIMagic="#pxaiwriter-do-ai-magic",selectors_expandSelection="#pxaiwriter-expand-selection",isDebugMode=()=>{var _M,_M$cfg;return!(null===(_M=M)||void 0===_M||null===(_M$cfg=_M.cfg)||void 0===_M$cfg||!_M$cfg.developerdebug)},getStepTextArea=step=>document.querySelector('textarea[name="pxaiwriter-data-step-'.concat(step,'"]')),getCurrentStep=element=>{var _element$dataset;const currentStep=Number.parseInt(null==element||null===(_element$dataset=element.dataset)||void 0===_element$dataset?void 0:_element$dataset.step);return Number.isNaN(currentStep)?0:currentStep},getStepInputText=step=>{var _getStepTextArea$valu,_getStepTextArea;return null!==(_getStepTextArea$valu=null===(_getStepTextArea=getStepTextArea(step))||void 0===_getStepTextArea?void 0:_getStepTextArea.value)&&void 0!==_getStepTextArea$valu?_getStepTextArea$valu:""},validateInputText=text=>!(!text||0===text.length)||((0,_jquery.default)("#title-required-warning-modal").modal("show"),!1),loadingData=()=>{(0,_jquery.default)(":button").prop("disabled",!0),(0,_jquery.default)("#loader").removeClass("d-none")},getCurrentStepFromPageChangeEvent=event=>{var _event$detail;return null==event||null===(_event$detail=event.detail)||void 0===_event$detail?void 0:_event$detail.currentStep},requestAIApi=function(methodName,assignmentId,text){let step=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return _ajax.default.call([{methodname:methodName,args:{assignment_id:assignmentId,step:step,text:text}}])[0]},api_expandText=(assignmentId,text)=>requestAIApi("assignsubmission_pxaiwriter_expand_ai_text",assignmentId,text,1),api_generateText=(assignmentId,text)=>requestAIApi("assignsubmission_pxaiwriter_generate_ai_text",assignmentId,text,1),api_recordHistory=(assignmentId,text)=>requestAIApi("assignsubmission_pxaiwriter_record_history",assignmentId,text,1);EventCreator.prototype.init=function(){const blurStepButton=button=>{button instanceof HTMLElement&&(button.classList.remove("btn-outline-primary"),button.classList.add("btn-outline-secondary"))},getSelectedTextAreaText=step=>{const textArea=getStepTextArea(step);return textArea instanceof HTMLTextAreaElement?(this.selectedStart=textArea.selectionStart,this.selectedEnd=textArea.selectionEnd,textArea.value.substring(this.selectedStart,this.selectedEnd)):(window.console.warn("".concat(component,": No text was selected")),"")},wrapper=document.querySelector(selectors_wrapper);wrapper.addEventListener(eventList_pageChange,(e=>{isDebugMode()&&window.console.log("".concat(component,": Step switched..."));let step=getCurrentStepFromPageChangeEvent(e);const currentStepButton=document.querySelector('.step-page-button[data-step-number="'.concat(step,'"]'));if(!currentStepButton)return;const allStepButtons=document.querySelectorAll(".step-page-button[data-step-number]");for(const button of allStepButtons)blurStepButton(button);var button;(button=currentStepButton)instanceof HTMLElement&&(button.classList.add("btn-outline-primary"),button.classList.remove("btn-outline-secondary"))})),wrapper.addEventListener(eventList_stepTextSave,(async e=>{isDebugMode()&&window.console.log("".concat(component,": Saving history..."));const step=getCurrentStepFromPageChangeEvent(e),text=getStepInputText(step);await api_recordHistory(this.assignmentId,text,1),isDebugMode()&&window.console.log("".concat(component,": Input text got recorded"))})),document.querySelector(selectors_expandSelection).addEventListener("click",(async e=>{isDebugMode()&&window.console.log("".concat(component,": Expand selected text..."));const text=getSelectedTextAreaText(getCurrentStep(e.target));if(validateInputText(text)){loadingData();try{const response=await api_expandText(this.assignmentId,text,this.currentStep);setApiResponseToInput(this.currentStep,response)}catch(exception){await _notification.default.exception(exception)}}else isDebugMode()&&window.console.warn("".concat(component,": No selection detected"))})),document.querySelector(selectors_doAIMagic).addEventListener("click",(async e=>{isDebugMode()&&window.console.log("".concat(component,": Do AI magic..."));const text=getStepInputText(getCurrentStep(e.target));if(validateInputText(text)){loadingData();try{const response=await api_generateText(this.assignmentId,text,this.currentStep);setApiResponseToInput(this.currentStep,response)}catch(exception){await _notification.default.exception(exception)}}else isDebugMode()&&window.console.warn("".concat(component,": Input text is empty"))}))};const setApiResponseToInput=(step,response)=>{if((0,_jquery.default)(":button").prop("disabled",!1),response.hasOwnProperty("attempt_text")&&(text=>{if(!text)return;const label=document.querySelector(".remaining-ai-attempts");label instanceof HTMLElement&&(label.innerHTML=text)})(response.attempt_text),response.hasOwnProperty("data")){const textArea=getStepTextArea(step);textArea instanceof HTMLTextAreaElement&&(textArea.value=response.data,textArea.dispatchEvent(new Event("change")))}(0,_jquery.default)("#loader").addClass("d-none")};return new EventCreator(assignmentId)}}));

//# sourceMappingURL=pxaiendpoint.min.js.map