define("assignsubmission_pxaiwriter/pxaiendpoint",["exports","jquery","core/ajax","core/notification"],(function(_exports,_jquery,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.init=assignmentId=>{let EventCreator=function(assignmentId){this.currentStep=0,this.selectedStart=0,this.selectedEnd=0,this.assignmentId=assignmentId,this.init()};const eventList_pageChange="page-change",getStepTextArea=step=>document.querySelector('textarea[name="pxaiwriter-data-step-'.concat(step,'"]')),getCurrentStep=element=>{var _element$dataset;const currentStep=Number.parseInt(null==element||null===(_element$dataset=element.dataset)||void 0===_element$dataset?void 0:_element$dataset.step);return Number.isNaN(currentStep)?0:currentStep},loadingData=()=>{(0,_jquery.default)(":button").prop("disabled",!0),(0,_jquery.default)("#loader").removeClass("d-none")},requestAIApi=function(methodName,assignmentId,text){let step=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return _ajax.default.call([{methodname:methodName,args:{assignment_id:assignmentId,step:step,text:text}}])[0]};EventCreator.prototype.init=function(){const actionsContainer=(0,_jquery.default)(".actions-container"),blurStepButton=button=>{button instanceof HTMLElement&&(button.classList.remove("btn-outline-primary"),button.classList.add("btn-outline-secondary"))},getSelectedTextAreaText=step=>{const textArea=getStepTextArea(step);return textArea instanceof HTMLTextAreaElement?(this.selectedStart=textArea.selectionStart,this.selectedEnd=textArea.selectionEnd,textArea.value.substring(this.selectedStart,this.selectedEnd)):(window.console.warn("Error: No text was selected"),"")};document.querySelector(".assignsubmission_pxaiwriter").addEventListener(eventList_pageChange,(e=>{let step=null==(event=e)||null===(_event$detail=event.detail)||void 0===_event$detail?void 0:_event$detail.currentStep;var event,_event$detail;const currentStepButton=document.querySelector('.step-page-button[data-step-number="'.concat(step,'"]'));if(!currentStepButton)return;const allStepButtons=document.querySelectorAll(".step-page-button[data-step-number]");for(const button of allStepButtons)blurStepButton(button);var button;(button=currentStepButton)instanceof HTMLElement&&(button.classList.add("btn-outline-primary"),button.classList.remove("btn-outline-secondary"))})),actionsContainer.on("click","#pxaiwriter-expand-selection",(async e=>{const selectedText=getSelectedTextAreaText(getCurrentStep(e.target));if(selectedText){loadingData();try{const response=await requestAIApi("assignsubmission_pxaiwriter_expand_ai_text",this.assignmentId,selectedText,this.currentStep);setApiResponseToInput(this.currentStep,response)}catch(exception){await _notification.default.exception(exception)}}else(0,_jquery.default)("#text-selection-required-warning-modal").modal("show")})),actionsContainer.on("click","#pxaiwriter-do-ai-magic",(async e=>{const titleText=(step=getCurrentStep(e.target),null!==(_getStepTextArea$valu=null===(_getStepTextArea=getStepTextArea(step))||void 0===_getStepTextArea?void 0:_getStepTextArea.value)&&void 0!==_getStepTextArea$valu?_getStepTextArea$valu:"");var step,_getStepTextArea$valu,_getStepTextArea;if((text=titleText)&&0!==text.length||((0,_jquery.default)("#title-required-warning-modal").modal("show"),0)){var text;loadingData();try{const response=await requestAIApi("assignsubmission_pxaiwriter_generate_ai_text",this.assignmentId,titleText,this.currentStep);setApiResponseToInput(this.currentStep,response)}catch(exception){await _notification.default.exception(exception)}}}))};const setApiResponseToInput=(step,response)=>{if((0,_jquery.default)(":button").prop("disabled",!1),response.hasOwnProperty("attempt_text")&&(text=>{if(!text)return;const label=document.querySelector(".remaining-ai-attempts");label instanceof HTMLElement&&(label.innerHTML=text)})(response.attempt_text),response.hasOwnProperty("data")){const textArea=getStepTextArea(step);textArea instanceof HTMLTextAreaElement&&(textArea.value=response.data,textArea.dispatchEvent(new Event("change")))}(0,_jquery.default)("#loader").addClass("d-none")};return new EventCreator(assignmentId)}}));

//# sourceMappingURL=pxaiendpoint.min.js.map